(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[177],{30347:()=>{},59959:(e,t,r)=>{"use strict";r.d(t,{F:()=>n,y:()=>l});var a=r(23464);let s=r(49509).env.NEXT_PUBLIC_API_URL||"/api",n=a.A.create({baseURL:s,headers:{"Content-Type":"application/json"}}),o="autoforwardx_tokens",i="autoforwardx_user",l={async login(e){let{access_token:t,refresh_token:r,token_type:a,expires_in:s}=(await n.post("/auth/login",e)).data,o={access_token:t,refresh_token:r,token_type:a,expires_in:s};this.setTokens(o);let i=(await n.get("/auth/me",{headers:{Authorization:"Bearer ".concat(t)}})).data;return this.setUser(i),{tokens:o,user:i}},async register(e){let{access_token:t,refresh_token:r,token_type:a,expires_in:s}=(await n.post("/auth/register",e)).data,o={access_token:t,refresh_token:r,token_type:a,expires_in:s};this.setTokens(o);let i=(await n.get("/auth/me",{headers:{Authorization:"Bearer ".concat(t)}})).data;return this.setUser(i),{tokens:o,user:i}},async sendTelegramOTP(e){await n.post("/auth/telegram/send-otp",e)},async verifyTelegramOTP(e){let{access_token:t,refresh_token:r,token_type:a,expires_in:s}=(await n.post("/auth/telegram/verify-otp",e)).data,o={access_token:t,refresh_token:r,token_type:a,expires_in:s};this.setTokens(o);let i=(await n.get("/auth/me",{headers:{Authorization:"Bearer ".concat(t)}})).data;return this.setUser(i),{tokens:o,user:i}},async refreshToken(e){let t=(await n.post("/auth/refresh",{refresh_token:e})).data;return this.setTokens(t),t},async getCurrentUser(){let e=this.getTokens();if(!e)throw Error("No authentication tokens found");let t=(await n.get("/auth/me",{headers:{Authorization:"Bearer ".concat(e.access_token)}})).data;return this.setUser(t),t},setTokens(e){localStorage.setItem(o,JSON.stringify(e))},getTokens(){let e=localStorage.getItem(o);return e?JSON.parse(e):null},setUser(e){localStorage.setItem(i,JSON.stringify(e))},getUser(){let e=localStorage.getItem(i);return e?JSON.parse(e):null},logout(){localStorage.removeItem(o),localStorage.removeItem(i)},isAuthenticated(){let e=this.getTokens();return!!(null==e?void 0:e.access_token)},getAccessToken(){let e=this.getTokens();return(null==e?void 0:e.access_token)||null},getRefreshToken(){let e=this.getTokens();return(null==e?void 0:e.refresh_token)||null},async sendOTP(e){return this.sendTelegramOTP({phone_number:e})},async verifyOTP(e,t){let r=await this.verifyTelegramOTP({phone_number:e,otp_code:t});return{access_token:r.tokens.access_token,refresh_token:r.tokens.refresh_token}}};n.interceptors.request.use(e=>{let t=l.getTokens();return(null==t?void 0:t.access_token)&&(e.headers.Authorization="Bearer ".concat(t.access_token)),e}),n.interceptors.response.use(e=>e,async e=>{var t;if((null==(t=e.response)?void 0:t.status)===401){let t=l.getTokens();if(null==t?void 0:t.refresh_token)try{let r=await l.refreshToken(t.refresh_token),a=e.config;return a.headers.Authorization="Bearer ".concat(r.access_token),n(a)}catch(e){l.logout(),window.location.href="/login"}else l.logout(),window.location.href="/login"}return Promise.reject(e)})},61118:(e,t,r)=>{"use strict";r.d(t,{Providers:()=>i});var a=r(95155);r(12115);var s=r(34540),n=r(13568),o=r(20666);function i(e){let{children:t}=e;return(0,a.jsxs)(s.Kq,{store:o.M_,children:[t,(0,a.jsx)(n.l$,{position:"top-right",toastOptions:{duration:4e3,style:{background:"rgba(55, 65, 81, 0.95)",color:"#fff",border:"1px solid rgba(75, 85, 99, 0.5)",borderRadius:"12px",backdropFilter:"blur(10px)",fontSize:"14px"},success:{iconTheme:{primary:"#10b981",secondary:"#fff"}},error:{iconTheme:{primary:"#ef4444",secondary:"#fff"}}}})]})}},78346:e=>{e.exports={style:{fontFamily:"'Inter', 'Inter Fallback'",fontStyle:"normal"},className:"__className_e8ce0c"}},89519:(e,t,r)=>{"use strict";r.d(t,{Ay:()=>f,HW:()=>d,iD:()=>n,kz:()=>l,ri:()=>c});var a=r(5710),s=r(59959);let n=(0,a.zD)("auth/login",async(e,t)=>{let{rejectWithValue:r}=t;try{return await s.y.login(e)}catch(e){return r(e.message||"Login failed")}}),o=(0,a.zD)("auth/sendTelegramOTP",async(e,t)=>{let{rejectWithValue:r}=t;try{return await s.y.sendTelegramOTP(e)}catch(e){return r(e.message||"Failed to send OTP")}}),i=(0,a.zD)("auth/verifyTelegramOTP",async(e,t)=>{let{rejectWithValue:r}=t;try{return await s.y.verifyTelegramOTP(e)}catch(e){return r(e.message||"OTP verification failed")}}),l=(0,a.zD)("auth/register",async(e,t)=>{let{rejectWithValue:r}=t;try{return await s.y.register(e)}catch(e){return r(e.message||"Registration failed")}}),d=(0,a.zD)("auth/getCurrentUser",async(e,t)=>{let{rejectWithValue:r}=t;try{return await s.y.getCurrentUser()}catch(e){return r(e.message||"Failed to get user info")}}),u=(0,a.Z0)({name:"auth",initialState:{user:null,tokens:null,isLoading:!1,error:null},reducers:{logout:e=>{e.user=null,e.tokens=null,e.error=null,s.y.logout()},clearError:e=>{e.error=null},setTokens:(e,t)=>{e.tokens=t.payload}},extraReducers:e=>{e.addCase(n.pending,e=>{e.isLoading=!0,e.error=null}).addCase(n.fulfilled,(e,t)=>{e.isLoading=!1,e.tokens=t.payload.tokens,e.user=t.payload.user}).addCase(n.rejected,(e,t)=>{e.isLoading=!1,e.error=t.payload}).addCase(l.pending,e=>{e.isLoading=!0,e.error=null}).addCase(l.fulfilled,(e,t)=>{e.isLoading=!1,e.tokens=t.payload.tokens,e.user=t.payload.user}).addCase(l.rejected,(e,t)=>{e.isLoading=!1,e.error=t.payload}).addCase(o.pending,e=>{e.isLoading=!0,e.error=null}).addCase(o.fulfilled,e=>{e.isLoading=!1}).addCase(o.rejected,(e,t)=>{e.isLoading=!1,e.error=t.payload}).addCase(i.pending,e=>{e.isLoading=!0,e.error=null}).addCase(i.fulfilled,(e,t)=>{e.isLoading=!1,e.tokens=t.payload.tokens,e.user=t.payload.user}).addCase(i.rejected,(e,t)=>{e.isLoading=!1,e.error=t.payload}).addCase(d.fulfilled,(e,t)=>{e.user=t.payload})}}),{logout:c,clearError:g,setTokens:h}=u.actions,f=u.reducer},96685:(e,t,r)=>{Promise.resolve().then(r.t.bind(r,78346,23)),Promise.resolve().then(r.t.bind(r,30347,23)),Promise.resolve().then(r.bind(r,61118))}},e=>{var t=t=>e(e.s=t);e.O(0,[838,464,555,568,666,441,684,358],()=>t(96685)),_N_E=e.O()}]);